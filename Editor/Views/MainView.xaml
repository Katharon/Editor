<Page x:Class="Editor.Views.MainView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:viewModels="clr-namespace:Editor.ViewModels"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="MainView">

    <Page.DataContext>
        <viewModels:MainViewModel />
    </Page.DataContext>

    <Page.InputBindings>
        <KeyBinding Modifiers="Ctrl" Key="N" Command="{Binding NewCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="O" Command="{Binding OpenCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="S" Command="{Binding SaveCommand}" />
        <KeyBinding Modifiers="Ctrl+Shift" Key="S" Command="{Binding SaveAsCommand}" />
        <KeyBinding Modifiers="Alt" Key="F4" Command="{Binding ExitCommand}" />
    </Page.InputBindings>

    <DockPanel>
        <!-- Menu -->
        <Menu DockPanel.Dock="Top" Background="#444">
            <MenuItem Header="_Datei">
                <MenuItem Header="_Neu" InputGestureText="Strg+N" Command="{Binding NewCommand}" />
                <MenuItem Header="_Öffnen" InputGestureText="Strg+O" Command="{Binding OpenCommand}" />
                <Separator />
                <MenuItem Header="_Speichern" InputGestureText="Strg+S" Command="{Binding SaveCommand}" />
                <MenuItem Header="Speichern _unter" InputGestureText="Strg+Umschalt+S" Command="{Binding SaveAsCommand}" />
                <Separator />
                <MenuItem Header="_Beenden" InputGestureText="Alt+F4" Command="{Binding ExitCommand}" />
            </MenuItem>

            <MenuItem Header="_Bearbeiten">
                <MenuItem Header="_Rückgängig" InputGestureText="Strg+Z" Command="ApplicationCommands.Undo" />
                <MenuItem Header="Wieder_herstellen" InputGestureText="Strg+Y" Command="ApplicationCommands.Redo" />
            </MenuItem>

            <MenuItem Header="_Extensions">
                <MenuItem Header="Extension-_Verwaltung" InputGestureText="Strg+V" Command="{Binding ManageExtensionSetsCommand}" />
                <MenuItem Header="Dateitypen-_Mapping" InputGestureText="Strg+M" Command="{Binding ManageMappingsCommand}" />
            </MenuItem>

            <MenuItem Header="Hilfe">
                <MenuItem Header="Info" Command="{Binding AboutCommand}" />
            </MenuItem>
        </Menu>

        <!-- Tool Bar -->
        <ToolBarTray DockPanel.Dock="Top" Background="#666">
            <ToolBar>
                <Button Content="📄" ToolTip="Neu" Command="{Binding NewCommand}" />
                <Button Content="📂" ToolTip="Öffnen" Command="{Binding OpenCommand}" />
                <Button Content="💾" ToolTip="Speichern" Command="{Binding SaveCommand}" />
                <Separator />
                <Button Content="⚙" ToolTip="Extension-Sets" Command="{Binding ManageExtensionSetsCommand}" />
            </ToolBar>
        </ToolBarTray>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="#666">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding CaretPosition}" />
            </StatusBarItem>
        </StatusBar>

        <!-- Main Content -->
        <Grid Background="#888">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Side Bar -->
            <Border Grid.Column="0" BorderBrush="#666" BorderThickness="0,0,1,0">
                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Extension-Sets" />
                    <ListBox ItemsSource="{Binding ExtensionSets}" SelectedItem="{Binding SelectedExtensionSet}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel>
                                    <CheckBox IsChecked="{Binding IsActive}" />
                                    <TextBlock Text="{Binding Name}" />
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Neu" Command="{Binding AddSetCommand}" />
                        <Button Content="Bearbeiten" Command="{Binding EditSetCommand}" IsEnabled="{Binding SelectedExtensionSet}" />
                        <Button Content="Löschen" Command="{Binding DeleteSetCommand}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Tab Control -->
            <TabControl Grid.Column="1" ItemsSource="{Binding Documents}" SelectedItem="{Binding ActiveDocument}">
                <!-- Tab Header -->
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding FileName}" />
                    </DataTemplate>
                </TabControl.ItemTemplate>

                <!-- Tab Content -->
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <RichTextBox AcceptsTab="True"
                                     VerticalScrollBarVisibility="Auto"
                                     HorizontalScrollBarVisibility="Auto"
                                     FontFamily="Consolas"
                                     FontSize="14"
                                     TextChanged="RichTextBox_TextChanged"
                                     Document="{Binding FlowDocument}" />
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
        </Grid>
    </DockPanel>

</Page>
